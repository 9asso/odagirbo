<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Santa Natal app">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Santa Natal">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Santa Natal</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
<script id="appsgen-live-test-bridge">
(function(){
  function post(){
    try {
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({ type: "appsgen:location", href: window.location.href }, "*");
      }
    } catch (e) {}
  }
  async function ensureHtml2Canvas(){
    if (window.html2canvas) return window.html2canvas;
    await new Promise(function(resolve, reject){
      var s = document.createElement("script");
      s.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
      s.async = true;
      s.onload = resolve;
      s.onerror = function(){ reject(new Error("Failed to load html2canvas")); };
      document.head.appendChild(s);
    });
    return window.html2canvas;
  }
  function pickBestCanvas(){
    try {
      var canvases = Array.prototype.slice.call(document.querySelectorAll("canvas"));
      if (!canvases.length) return null;
      var best = null;
      var bestArea = 0;
      for (var i=0;i<canvases.length;i++){
        var c = canvases[i];
        var w = c.width || 0;
        var h = c.height || 0;
        var area = w*h;
        if (area > bestArea){ bestArea = area; best = c; }
      }
      return best;
    } catch (e) { return null; }
  }
  async function capturePngDataUrl(){
    var canvas = pickBestCanvas();
    if (canvas && canvas.toDataURL){
      try { return canvas.toDataURL("image/png"); } catch (e) {}
    }
    var h2c = await ensureHtml2Canvas();
    var snap = await h2c(document.body, { backgroundColor: null, useCORS: true, logging: false });
    return snap.toDataURL("image/png");
  }
  window.addEventListener("message", function(event){
    try {
      var d = event && event.data;
      if (!d || typeof d !== "object") return;
      if (d.type !== "appsgen:screenshot-request") return;
      var requestId = d.requestId;
      if (!requestId) return;
      var respond = function(payload){
        try {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage(Object.assign({ type: "appsgen:screenshot-response", requestId: requestId, href: window.location.href }, payload), "*");
          }
        } catch (e) {}
      };
      capturePngDataUrl().then(function(dataUrl){
        respond({ ok: true, dataUrl: dataUrl });
      }).catch(function(err){
        respond({ ok: false, error: String((err && err.message) || err || "Screenshot failed") });
      });
    } catch (e) {}
  });
  window.addEventListener("hashchange", post);
  window.addEventListener("popstate", post);
  window.addEventListener("load", post);
  setInterval(post, 1000);
  post();
})();
</script>
</body>
</html>
